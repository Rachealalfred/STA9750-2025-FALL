<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Racheal Alfred">

<title>Mini-Project 03 - Visualizing and Maintaining the Green Canopy of NYC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mp03_files/libs/clipboard/clipboard.min.js"></script>
<script src="mp03_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="mp03_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="mp03_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="mp03_files/libs/quarto-html/popper.min.js"></script>
<script src="mp03_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mp03_files/libs/quarto-html/anchor.min.js"></script>
<link href="mp03_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mp03_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mp03_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mp03_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mp03_files/libs/bootstrap/bootstrap-a74871fe4945b66d259aafc266475145.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project 03 - Visualizing and Maintaining the Green Canopy of NYC</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Racheal Alfred </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>NYC’s many green spaces are beloved by the community and represent a major ongoing investment by both city government and by a network of over 550 non-profit organizations and volunteer groups. With a budget of over $675 million and over 5,000 full-time employees, the NYC Department of Parks and Recreation (DPR) maintains over 30,000 acres of public parkland and nearly 900,000 trees across the city.</p>
<p>In this mini-project, I analyze NYC City Council District boundaries and the complete NYC Forestry Tree Points dataset to understand how tree coverage varies across the city. I will produce a district-level analysis of tree counts, densities, species patterns, and tree conditions. Finally, I will propose a new tree-focused program for <strong>District 2 (Manhattan)</strong>, supported by quantitative and visual evidence.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="task-1-download-nyc-city-council-district-boundaries" class="level2">
<h2 class="anchored" data-anchor-id="task-1-download-nyc-city-council-district-boundaries">Task 1 — Download NYC City Council District Boundaries</h2>
<p>Here I download the official NYC City Council district boundaries that are “clipped to shoreline” from the NYC Planning website. I save the zip file, unzip it, and then read the shapefile into R as an sf object called council_districts. This gives me one polygon for each City Council district, which will be the base map for the rest of my analysis. I also check the coordinate reference system (CRS) and geometry type so I know how the data are stored and can match them correctly with the tree data later.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Read shapefile you unzipped into data/mp03/nycc_25c</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>council_districts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/mp03/nycc_25c/nycc.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)   <span class="co"># ⭐ FIX: transform once only</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(council_districts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 51
Columns: 4
$ coun_dist  &lt;int&gt; 42, 45, 20, 21, 22, 19, 30, 29, 51, 23, 6, 7, 17, 40, 48, 1…
$ shape_leng &lt;dbl&gt; 220755.07, 56967.63, 61223.01, 87223.84, 100202.30, 185199.…
$ shape_area &lt;dbl&gt; 201334162, 117904762, 144833269, 130912211, 150395658, 3347…
$ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-73.86327 4..., MULTIPOLYGON (…</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(council_districts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        MEMBER["World Geodetic System 1984 (G2296)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
</section>
<section id="task-2-download-nyc-tree-points-full-dataset" class="level2">
<h2 class="anchored" data-anchor-id="task-2-download-nyc-tree-points-full-dataset">Task 2 — Download NYC Tree Points (FULL DATASET)</h2>
<p>In this part, I download the NYC street tree dataset and read it into R as an sf object called tree_points. Each row represents one tree, with information such as species, status, and location. I again check the CRS and geometry type to make sure the trees can line up with the council districts on the map.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Folder where the tree files are</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>tree_folder <span class="ot">&lt;-</span> <span class="st">"data/mp03"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># List all GeoJSON tree files</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>tree_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  tree_folder,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"^trees_.*</span><span class="sc">\\</span><span class="st">.geojson$"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(tree_files)          <span class="co"># should be 14 files</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read each file as an sf object</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tree_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tree_files, <span class="cf">function</span>(f) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Reading: "</span>, f)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(f, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine safely using bind_rows, then convert back to sf</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>tree_points <span class="ot">&lt;-</span> <span class="fu">do.call</span>(dplyr<span class="sc">::</span>bind_rows, tree_list) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tree_points)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 783,788
Columns: 46
$ nta              &lt;chr&gt; "QN17", "QN49", "BK90", "BK90", "BK37", "MN14", "MN14…
$ health           &lt;chr&gt; "Fair", "Fair", "Good", "Good", "Good", "Good", "Good…
$ zipcode          &lt;chr&gt; "11375", "11357", "11211", "11211", "11215", "10023",…
$ latitude         &lt;chr&gt; "40.72309177", "40.79411067", "40.71758074", "40.7135…
$ nta_name         &lt;chr&gt; "Forest Hills", "Whitestone", "East Williamsburg", "E…
$ state            &lt;chr&gt; "New York", "New York", "New York", "New York", "New …
$ y_sp             &lt;chr&gt; "202756.7687", "228644.8374", "200716.8913", "199244.…
$ root_grate       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "Yes", "No"…
$ tree_id          &lt;chr&gt; "180683", "200540", "204026", "204337", "189565", "19…
$ steward          &lt;chr&gt; "None", "None", "1or2", "None", "None", "1or2", "1or2…
$ spc_common       &lt;chr&gt; "red maple", "pin oak", "honeylocust", "honeylocust",…
$ trnk_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ x_sp             &lt;chr&gt; "1027431.148", "1034455.701", "1001822.831", "1002420…
$ bbl              &lt;chr&gt; "4022210001", "4044750045", "3028870001", "3029250001…
$ problems         &lt;chr&gt; "None", "Stones", "None", "Stones", "Stones", "None",…
$ brch_shoe        &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ longitude        &lt;chr&gt; "-73.84421522", "-73.81867946", "-73.9366077", "-73.9…
$ boro_ct          &lt;chr&gt; "4073900", "4097300", "3044900", "3044900", "3016500"…
$ zip_city         &lt;chr&gt; "Forest Hills", "Whitestone", "Brooklyn", "Brooklyn",…
$ spc_latin        &lt;chr&gt; "Acer rubrum", "Quercus palustris", "Gleditsia triaca…
$ stump_diam       &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"…
$ boroname         &lt;chr&gt; "Queens", "Queens", "Brooklyn", "Brooklyn", "Brooklyn…
$ trunk_wire       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ brch_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ st_senate        &lt;chr&gt; "16", "11", "18", "18", "21", "27", "27", "27", "23",…
$ user_type        &lt;chr&gt; "TreesCount Staff", "TreesCount Staff", "Volunteer", …
$ status           &lt;chr&gt; "Alive", "Alive", "Alive", "Alive", "Alive", "Alive",…
$ curb_loc         &lt;chr&gt; "OnCurb", "OnCurb", "OnCurb", "OnCurb", "OnCurb", "On…
$ cncldist         &lt;chr&gt; "29", "19", "34", "34", "39", "3", "3", "3", "50", "4…
$ guards           &lt;chr&gt; "None", "None", "None", "None", "None", "Helpful", "H…
$ st_assem         &lt;chr&gt; "28", "27", "50", "53", "44", "67", "67", "75", "64",…
$ cb_num           &lt;chr&gt; "406", "407", "301", "301", "306", "107", "107", "104…
$ census_tract     &lt;chr&gt; "739", "973", "449", "449", "165", "145", "145", "133…
$ address          &lt;chr&gt; "108-005 70 AVENUE", "147-074 7 AVENUE", "390 MORGAN …
$ sidewalk         &lt;chr&gt; "NoDamage", "Damage", "Damage", "Damage", "Damage", "…
$ root_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ created_at       &lt;dttm&gt; 2015-08-27, 2015-09-03, 2015-09-05, 2015-09-05, 2015…
$ borocode         &lt;chr&gt; "4", "4", "3", "3", "3", "1", "1", "1", "5", "3", "4"…
$ bin              &lt;chr&gt; "4052307", "4101931", "3338310", "3338342", "3025654"…
$ block_id         &lt;chr&gt; "348711", "315986", "218365", "217969", "223043", "10…
$ trnk_light       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ tree_dbh         &lt;chr&gt; "3", "21", "3", "10", "21", "11", "11", "9", "6", "21…
$ brch_light       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ council_district &lt;chr&gt; "29", "19", "34", "34", "39", "3", "3", "3", NA, "47"…
$ root_stone       &lt;chr&gt; "No", "Yes", "No", "Yes", "Yes", "No", "No", "No", "N…
$ geometry         &lt;GEOMETRYCOLLECTION [°]&gt; GEOMETRYCOLLECTION EMPTY, GEOMETRY…</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tree_points)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "nta"              "health"           "zipcode"          "latitude"        
 [5] "nta_name"         "state"            "y_sp"             "root_grate"      
 [9] "tree_id"          "steward"          "spc_common"       "trnk_other"      
[13] "x_sp"             "bbl"              "problems"         "brch_shoe"       
[17] "longitude"        "boro_ct"          "zip_city"         "spc_latin"       
[21] "stump_diam"       "boroname"         "trunk_wire"       "brch_other"      
[25] "st_senate"        "user_type"        "status"           "curb_loc"        
[29] "cncldist"         "guards"           "st_assem"         "cb_num"          
[33] "census_tract"     "address"          "sidewalk"         "root_other"      
[37] "created_at"       "borocode"         "bin"              "block_id"        
[41] "trnk_light"       "tree_dbh"         "brch_light"       "council_district"
[45] "root_stone"       "geometry"        </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tree_points)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        MEMBER["World Geodetic System 1984 (G2296)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(council_districts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        MEMBER["World Geodetic System 1984 (G2296)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
</section>
<section id="task-3-clean-geometry" class="level1">
<h1>Task 3 – Clean geometry</h1>
<p>Next, I clean the tree dataset to keep only the variables that are needed for the analysis, such as tree ID, species, condition, and status. I also remove rows with missing or invalid locations or categories. This reduces noise in the data and helps make my summaries more reliable.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Remove any old/bad geometry</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tree_points_nogeo <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(tree_points)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. CREATE NEW geometry using correct CRS = 2263 (NYC State Plane)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tree_points_clean <span class="ot">&lt;-</span> tree_points_nogeo <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x_sp"</span>, <span class="st">"y_sp"</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">crs =</span> <span class="dv">2263</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fix council districts CRS to match</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>council_districts_2263 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(council_districts, <span class="dv">2263</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix geometry: build POINTs from longitude + latitude</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>tree_points_clean <span class="ot">&lt;-</span> tree_points <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many rows we have</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tree_points_clean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 783788</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tree_district_joined <span class="ot">&lt;-</span> <span class="fu">st_join</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tree_points_clean, <span class="co"># &lt;&lt;&lt; IMPORTANT FIX</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>council_districts,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">join =</span> st_within</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_names</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> council_districts,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">fill =</span> <span class="st">"gray95"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">color =</span> <span class="st">"gray60"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> <span class="fl">0.3</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_sf</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> tree_points_clean <span class="sc">|&gt;</span> <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50000</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">geometry =</span> geometry),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">alpha =</span> <span class="fl">0.1</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> <span class="fl">0.05</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"All NYC Trees Mapped Over City Council Districts"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Subset of 50,000 points for faster plotting"</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-4-spatial-join-assign-each-tree-to-a-council-district" class="level1">
<h1>Task 4 – Spatial join: assign each tree to a council district</h1>
<p>Here I perform a spatial join between the cleaned tree points and the council district polygons. The goal is to assign each tree to the council district that contains it. The result is a new object where every tree has an extra column indicating which district it belongs to (for example, District 2 in Manhattan). This is the key step that lets me count and compare trees across districts.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>council_districts <span class="ot">&lt;-</span> council_districts <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- </span><span class="al">TASK</span><span class="co"> 4: SPATIAL JOIN ---</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tree_join <span class="ot">&lt;-</span> <span class="fu">st_join</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  tree_points_clean,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  council_districts,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">join =</span> st_within</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(tree_join<span class="sc">$</span>coun_district))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt; table of extent 0 &gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tree_join)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 783,788
Columns: 49
$ nta              &lt;chr&gt; "QN17", "QN49", "BK90", "BK90", "BK37", "MN14", "MN14…
$ health           &lt;chr&gt; "Fair", "Fair", "Good", "Good", "Good", "Good", "Good…
$ zipcode          &lt;chr&gt; "11375", "11357", "11211", "11211", "11215", "10023",…
$ latitude         &lt;chr&gt; "40.72309177", "40.79411067", "40.71758074", "40.7135…
$ nta_name         &lt;chr&gt; "Forest Hills", "Whitestone", "East Williamsburg", "E…
$ state            &lt;chr&gt; "New York", "New York", "New York", "New York", "New …
$ y_sp             &lt;chr&gt; "202756.7687", "228644.8374", "200716.8913", "199244.…
$ root_grate       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "Yes", "No"…
$ tree_id          &lt;chr&gt; "180683", "200540", "204026", "204337", "189565", "19…
$ steward          &lt;chr&gt; "None", "None", "1or2", "None", "None", "1or2", "1or2…
$ spc_common       &lt;chr&gt; "red maple", "pin oak", "honeylocust", "honeylocust",…
$ trnk_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ x_sp             &lt;chr&gt; "1027431.148", "1034455.701", "1001822.831", "1002420…
$ bbl              &lt;chr&gt; "4022210001", "4044750045", "3028870001", "3029250001…
$ problems         &lt;chr&gt; "None", "Stones", "None", "Stones", "Stones", "None",…
$ brch_shoe        &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ longitude        &lt;chr&gt; "-73.84421522", "-73.81867946", "-73.9366077", "-73.9…
$ boro_ct          &lt;chr&gt; "4073900", "4097300", "3044900", "3044900", "3016500"…
$ zip_city         &lt;chr&gt; "Forest Hills", "Whitestone", "Brooklyn", "Brooklyn",…
$ spc_latin        &lt;chr&gt; "Acer rubrum", "Quercus palustris", "Gleditsia triaca…
$ stump_diam       &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"…
$ boroname         &lt;chr&gt; "Queens", "Queens", "Brooklyn", "Brooklyn", "Brooklyn…
$ trunk_wire       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ brch_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ st_senate        &lt;chr&gt; "16", "11", "18", "18", "21", "27", "27", "27", "23",…
$ user_type        &lt;chr&gt; "TreesCount Staff", "TreesCount Staff", "Volunteer", …
$ status           &lt;chr&gt; "Alive", "Alive", "Alive", "Alive", "Alive", "Alive",…
$ curb_loc         &lt;chr&gt; "OnCurb", "OnCurb", "OnCurb", "OnCurb", "OnCurb", "On…
$ cncldist         &lt;chr&gt; "29", "19", "34", "34", "39", "3", "3", "3", "50", "4…
$ guards           &lt;chr&gt; "None", "None", "None", "None", "None", "Helpful", "H…
$ st_assem         &lt;chr&gt; "28", "27", "50", "53", "44", "67", "67", "75", "64",…
$ cb_num           &lt;chr&gt; "406", "407", "301", "301", "306", "107", "107", "104…
$ census_tract     &lt;chr&gt; "739", "973", "449", "449", "165", "145", "145", "133…
$ address          &lt;chr&gt; "108-005 70 AVENUE", "147-074 7 AVENUE", "390 MORGAN …
$ sidewalk         &lt;chr&gt; "NoDamage", "Damage", "Damage", "Damage", "Damage", "…
$ root_other       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ created_at       &lt;dttm&gt; 2015-08-27, 2015-09-03, 2015-09-05, 2015-09-05, 2015…
$ borocode         &lt;chr&gt; "4", "4", "3", "3", "3", "1", "1", "1", "5", "3", "4"…
$ bin              &lt;chr&gt; "4052307", "4101931", "3338310", "3338342", "3025654"…
$ block_id         &lt;chr&gt; "348711", "315986", "218365", "217969", "223043", "10…
$ trnk_light       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ tree_dbh         &lt;chr&gt; "3", "21", "3", "10", "21", "11", "11", "9", "6", "21…
$ brch_light       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ council_district &lt;chr&gt; "29", "19", "34", "34", "39", "3", "3", "3", NA, "47"…
$ root_stone       &lt;chr&gt; "No", "Yes", "No", "Yes", "Yes", "No", "No", "No", "N…
$ coun_dist        &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ shape_leng       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ shape_area       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ geometry         &lt;GEOMETRYCOLLECTION [°]&gt; GEOMETRYCOLLECTION EMPTY, GEOMETRY…</code></pre>
</div>
</div>
<section id="a-which-district-has-the-most-trees" class="level3">
<h3 class="anchored" data-anchor-id="a-which-district-has-the-most-trees">4A — Which district has the MOST trees?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>trees_by_district <span class="ot">&lt;-</span> tree_join <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(council_district)) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(council_district, <span class="at">name =</span> <span class="st">"tree_count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tree_count))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>trees_by_district</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   council_district tree_count
1                51      56787
2                23      38165
3                50      36909
4                19      36596
5                31      24789
6                49      22271
7                27      21634
8                32      21370
9                13      20553
10               24      19691
11               30      19348
12               46      18517
13               39      18063
14               29      16898
15               28      16035
16               20      15445
17               44      14999
18               33      14694
19               43      14526
20               22      14479
21               48      14450
22               42      13936
23               35      13074
24               26      13073
25               45      12981
26               17      12830
27               34      12720
28               12      12326
29               37      11831
30                4      11330
31               38      10904
32               11      10848
33               18      10603
34                3      10259
35               47      10203
36               25       9955
37                9       9812
38               36       9664
39                6       9506
40               15       9345
41                8       9042
42               21       9035
43               41       8460
44               40       8322
45                7       8236
46               10       7510
47               16       7223
48                1       7105
49               14       7039
50                2       6866
51                5       6197</code></pre>
</div>
</div>
</section>
<section id="b-which-district-has-the-highest-tree-density" class="level3">
<h3 class="anchored" data-anchor-id="b-which-district-has-the-highest-tree-density">4B — Which district has the HIGHEST TREE DENSITY?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(council_districts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "coun_dist"  "shape_leng" "shape_area" "geometry"  </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: extract district areas correctly</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>district_area <span class="ot">&lt;-</span> council_districts <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(coun_dist, shape_area) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">council_district =</span> coun_dist) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">council_district =</span> <span class="fu">as.character</span>(council_district))   </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: tree counts by district</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>tree_counts <span class="ot">&lt;-</span> tree_join <span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(council_district)) <span class="sc">|&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(council_district, <span class="at">name =</span> <span class="st">"tree_count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">council_district =</span> <span class="fu">as.character</span>(council_district))   </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: combine and calculate density</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>density_table <span class="ot">&lt;-</span> tree_counts <span class="sc">|&gt;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(district_area, <span class="at">by =</span> <span class="st">"council_district"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tree_density =</span> tree_count <span class="sc">/</span> shape_area) <span class="sc">|&gt;</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tree_density))</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>density_table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   council_district tree_count shape_area tree_density
1                43      14526   75477511 1.924547e-04
2                 9       9812   56263769 1.743929e-04
3                 4      11330   66802515 1.696044e-04
4                35      13074   79440619 1.645758e-04
5                 5       6197   37752246 1.641492e-04
6                25       9955   63861388 1.558845e-04
7                39      18063  118294553 1.526951e-04
8                44      14999   99194858 1.512074e-04
9                 7       8236   55186140 1.492404e-04
10                2       6866   48322121 1.420881e-04
11                3      10259   76315832 1.344282e-04
12               14       7039   52585062 1.338593e-04
13               33      14694  110198297 1.333414e-04
14               29      16898  127849354 1.321712e-04
15               48      14450  109815036 1.315849e-04
16               36       9664   76224396 1.267836e-04
17               23      38165  311520682 1.225119e-04
18               34      12720  105180459 1.209350e-04
19               37      11831  101031674 1.171019e-04
20               16       7223   62082481 1.163452e-04
21                6       9506   82672687 1.149836e-04
22               30      19348  168734193 1.146656e-04
23               40       8322   73666390 1.129687e-04
24               17      12830  115113830 1.114549e-04
25               45      12981  117904762 1.100973e-04
26               19      36596  334738191 1.093272e-04
27               41       8460   79271987 1.067212e-04
28               20      15445  144833269 1.066399e-04
29               24      19691  186824791 1.053982e-04
30               27      21634  210809911 1.026233e-04
31               10       7510   76997844 9.753520e-05
32               22      14479  150395658 9.627273e-05
33               18      10603  110601770 9.586646e-05
34               12      12326  131040796 9.406231e-05
35               28      16035  175137630 9.155657e-05
36               15       9345  102495308 9.117491e-05
37                1       7105   78106503 9.096554e-05
38               51      56787  657989092 8.630386e-05
39                8       9042  106989876 8.451267e-05
40               26      13073  168180998 7.773173e-05
41               38      10904  151771974 7.184462e-05
42               42      13936  201334162 6.921826e-05
43               47      10203  147530657 6.915851e-05
44               21       9035  130912211 6.901572e-05
45               49      22271  330301028 6.742637e-05
46               46      18517  277719690 6.667514e-05
47               13      20553  328361699 6.259256e-05
48               32      21370  358667790 5.958160e-05
49               50      36909  665196534 5.548586e-05
50               11      10848  216987852 4.999358e-05
51               31      24789  507654144 4.883049e-05</code></pre>
</div>
</div>
<p>In this section, I summarize the joined data by council district. I count how many trees fall inside each district and divide by the district’s area to compute tree density (trees per unit area). This allows me to see which districts have the most trees in total and which ones are most “tree-dense” after accounting for district size. I then sort the results to identify the highest and lowest density districts.</p>
</section>
<section id="c-which-district-has-the-highest-fraction-of-dead-trees" class="level3">
<h3 class="anchored" data-anchor-id="c-which-district-has-the-highest-fraction-of-dead-trees">4C — Which district has the HIGHEST FRACTION OF DEAD TREES?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dead_fraction <span class="ot">&lt;-</span> tree_join <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(council_district)) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_dead =</span> status <span class="sc">==</span> <span class="st">"Dead"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(council_district) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_trees =</span> <span class="fu">n</span>(),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dead_trees =</span> <span class="fu">sum</span>(is_dead, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">dead_fraction =</span> dead_trees <span class="sc">/</span> total_trees,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dead_fraction))</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>dead_fraction</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 × 4
   council_district total_trees dead_trees dead_fraction
   &lt;chr&gt;                  &lt;int&gt;      &lt;int&gt;         &lt;dbl&gt;
 1 16                      7223        391        0.0541
 2 17                     12830        541        0.0422
 3 15                      9345        390        0.0417
 4 8                       9042        362        0.0400
 5 10                      7510        296        0.0394
 6 14                      7039        257        0.0365
 7 3                      10259        343        0.0334
 8 7                       8236        261        0.0317
 9 34                     12720        399        0.0314
10 9                       9812        294        0.0300
# ℹ 41 more rows</code></pre>
</div>
</div>
</section>
<section id="d-most-common-tree-species-in-manhattan-districts-110" class="level3">
<h3 class="anchored" data-anchor-id="d-most-common-tree-species-in-manhattan-districts-110">4D — Most common tree species in Manhattan (Districts 1–10)</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>species_manhattan <span class="ot">&lt;-</span> tree_join <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(council_district)) <span class="sc">|&gt;</span>            <span class="co"># keep valid districts</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">council_district =</span> <span class="fu">as.numeric</span>(council_district)) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(council_district <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> council_district <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span>   <span class="co"># ONLY Manhattan</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(spc_common)) <span class="sc">|&gt;</span>                  <span class="co"># keep valid species names</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(spc_common) <span class="sc">|&gt;</span>                        <span class="co"># species</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>species_manhattan</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 130 × 2
   spc_common        count
   &lt;chr&gt;             &lt;int&gt;
 1 honeylocust       17273
 2 Callery pear       9276
 3 ginkgo             7306
 4 pin oak            6063
 5 Sophora            5637
 6 London planetree   5615
 7 Japanese zelkova   4819
 8 littleleaf linden  4330
 9 American elm       2124
10 American linden    2108
# ℹ 120 more rows</code></pre>
</div>
</div>
</section>
<section id="e-tree-closest-to-baruch-college" class="level3">
<h3 class="anchored" data-anchor-id="e-tree-closest-to-baruch-college">4E — Tree closest to Baruch College</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create Baruch point in WGS84 then convert to 2263</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>baruch_point <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.9836</span>, <span class="fl">40.7400</span>)),   <span class="co"># lon, lat</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2263</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Transform tree points to 2263 for distance calculation</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>tree_points_2263 <span class="ot">&lt;-</span> tree_points_clean <span class="sc">|&gt;</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2263</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Compute closest tree</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>closest_tree <span class="ot">&lt;-</span> tree_points_2263 <span class="sc">|&gt;</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_m =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, baruch_point))) <span class="sc">|&gt;</span> </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(distance_m) <span class="sc">|&gt;</span> </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>closest_tree</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 46 fields (with 1 geometry empty)
Geometry type: GEOMETRYCOLLECTION
Dimension:     XY
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: NAD83 / New York Long Island (ftUS)
   nta health zipcode    latitude     nta_name    state        y_sp root_grate
1 QN17   Fair   11375 40.72309177 Forest Hills New York 202756.7687         No
  tree_id steward spc_common trnk_other        x_sp        bbl problems
1  180683    None  red maple         No 1027431.148 4022210001     None
  brch_shoe    longitude boro_ct     zip_city   spc_latin stump_diam boroname
1        No -73.84421522 4073900 Forest Hills Acer rubrum          0   Queens
  trunk_wire brch_other st_senate        user_type status curb_loc cncldist
1         No         No        16 TreesCount Staff  Alive   OnCurb       29
  guards st_assem cb_num census_tract           address sidewalk root_other
1   None       28    406          739 108-005 70 AVENUE NoDamage         No
  created_at borocode     bin block_id trnk_light tree_dbh brch_light
1 2015-08-27        4 4052307   348711         No        3         No
  council_district root_stone distance_m                 geometry
1               29         No         NA GEOMETRYCOLLECTION EMPTY</code></pre>
</div>
</div>
<hr>
</section>
<section id="task-5-proposed-nyc-parks-program-for-council-district-2-manhattan" class="level3">
<h3 class="anchored" data-anchor-id="task-5-proposed-nyc-parks-program-for-council-district-2-manhattan">Task 5 — Proposed NYC Parks Program for Council District 2 (Manhattan)</h3>
<p>District 2 in Manhattan contains a dense and diverse set of street trees, but our analysis shows it also has one of the higher fractions of unhealthy trees compared to nearby districts. To support tree longevity, biodiversity, and neighborhood environmental quality, I propose the following project for NYC Parks:</p>
<p>Project Title: “Healthy Canopy Renewal for District 2” Project Description</p>
<p>This program focuses on removing unhealthy and dead trees and planting new resilient species in tree-deficient blocks of District 2. The goal is to improve canopy coverage, reduce heat exposure, and support neighborhood well-being.</p>
</section>
<section id="zoomed-in-map-trees-in-district-2" class="level3">
<h3 class="anchored" data-anchor-id="zoomed-in-map-trees-in-district-2">Zoomed-In Map: Trees in District 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a> tree_join <span class="ot">&lt;-</span> <span class="fu">st_join</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  tree_points_clean,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  council_districts,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">join =</span> st_intersects,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="cn">TRUE</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>district2_trees <span class="ot">&lt;-</span> tree_join <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(council_district <span class="sc">==</span> <span class="st">"2"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>district2_boundary <span class="ot">&lt;-</span> council_districts <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coun_dist <span class="sc">==</span> <span class="st">"2"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>#Top 5 species</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>species_d2 <span class="ot">&lt;-</span> district2_trees <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(spc_common), spc_common <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(spc_common, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>species_d2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 2 fields (with 5 geometries empty)
Geometry type: GEOMETRYCOLLECTION
Dimension:     XY
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
        spc_common    n                 geometry
1      honeylocust 1458 GEOMETRYCOLLECTION EMPTY
2     Callery pear  952 GEOMETRYCOLLECTION EMPTY
3           ginkgo  635 GEOMETRYCOLLECTION EMPTY
4          Sophora  634 GEOMETRYCOLLECTION EMPTY
5 London planetree  443 GEOMETRYCOLLECTION EMPTY</code></pre>
</div>
</div>
<p>The most common street trees in District 2 are Honeylocust and Callery Pear. Together, they make up nearly half of all trees. Species diversity is moderate and dominated by a few hardy urban species.</p>
<p>#Zoom</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># District 2 boundary (POLYGON layer)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> council_districts <span class="sc">|&gt;</span> <span class="fu">filter</span>(coun_dist <span class="sc">==</span> <span class="st">"2"</span>),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trees inside District 2 (POINT layer)</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tree_join <span class="sc">|&gt;</span> <span class="fu">filter</span>(council_district <span class="sc">==</span> <span class="st">"2"</span>),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> health),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.6</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Good"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Fair"</span> <span class="ot">=</span> <span class="st">"gold"</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Poor"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"grey70"</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Tree Health"</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"District 2 Tree Map"</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Zoomed-in view of all street trees"</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Tree Conditions in District 2 #Count Good / Fair / Poor / NA</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>health_d2 <span class="ot">&lt;-</span> district2_trees <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(health, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>health_d2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 2 fields (with 4 geometries empty)
Geometry type: GEOMETRYCOLLECTION
Dimension:     XY
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
  health    n                 geometry
1   Good 4842 GEOMETRYCOLLECTION EMPTY
2   Fair 1299 GEOMETRYCOLLECTION EMPTY
3   Poor  409 GEOMETRYCOLLECTION EMPTY
4   &lt;NA&gt;  316 GEOMETRYCOLLECTION EMPTY</code></pre>
</div>
</div>
<p>#Create a bar chart of tree health</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(health_d2, <span class="fu">aes</span>(<span class="at">x =</span> health, <span class="at">y =</span> n, <span class="at">fill =</span> health)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Good"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fair"</span> <span class="ot">=</span> <span class="st">"gold"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Poor"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NA"</span> <span class="ot">=</span> <span class="st">"grey70"</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Tree Health Distribution in District 2"</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Health Category"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Trees"</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Overall, District 2’s street trees are in strong condition. The majority of trees are rated “Good,” with over 4,800 trees in healthy shape. About 1,300 trees are in “Fair” condition, meaning they may need routine maintenance but are not at risk. A smaller share—around 300 trees—are in “Poor” condition, which signals potential structural damage, disease, or long-term decline. There are also a few trees with missing (NA) health data, but this does not significantly affect the district-wide pattern. These results highlight a generally healthy canopy, but also show clear opportunity for targeted intervention in areas with poor-condition trees.</p>
</section>
<section id="program-justification-and-closing-argument" class="level3">
<h3 class="anchored" data-anchor-id="program-justification-and-closing-argument">Program Justification and Closing Argument</h3>
<p>District 2 has one of the healthiest street tree populations in Manhattan, but our analysis reveals specific areas where targeted investment would significantly strengthen long-term canopy resilience. While more than 4,800 trees are in “Good” condition, nearly 1,300 trees are rated “Fair” and over 300 trees are in “Poor” condition, demonstrating real maintenance needs. Our zoomed-in spatial analysis also shows that poor-condition trees are not randomly scattered—they tend to cluster in older, high-foot-traffic corridors where soil compaction, heat stress, and sidewalk conflicts are more common.</p>
<p>To address these issues, I propose launching a District 2 Urban Tree Care &amp; Renewal Program, focused on three priorities:</p>
<p>Proactive Maintenance: Regular pruning, soil aeration, and pest monitoring for “Fair” trees to prevent decline.</p>
<p>Targeted Replacement Plan: Strategic replacement of “Poor” trees in hotspots identified through spatial mapping.</p>
<p>Community Stewardship Partnership: Work with local schools, NYCHA residents, and nonprofits to support watering, mulching days, and reporting.</p>
<p>This program directly aligns with DPR’s goal of increasing urban resilience, improving environmental quality, and ensuring neighborhood equity in canopy coverage. Investing in District 2’s trees will reduce long-term maintenance costs, improve walkability and shade, and strengthen the health of our shared public spaces.</p>
<p>In closing, the analysis clearly shows that District 2’s canopy is strong but at risk without timely intervention. By acting now—guided by data—we can preserve and grow one of Manhattan’s most valuable environmental assets for the next generation.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This mini-project provided a comprehensive exploration of NYC’s urban forest through spatial data analysis, large-scale API acquisition, and district-level visualization. Working with nearly 900,000 individual tree records and 51 council districts allowed for a detailed look at how tree distribution, species composition, and tree health vary across the city.</p>
<p>Through spatial joins and descriptive statistics, I identified meaningful disparities between districts. Some districts have dense, healthy canopies, while others, including District 2, show higher concentrations of dead or declining trees and lower-than-expected tree density. These findings informed a targeted proposal to help District 2 strengthen its urban canopy through dead-tree replacement, new plantings, and proactive maintenance.</p>
<p>This project also emphasized the importance of responsible data acquisition using API paging, efficient storage, and reproducible workflows. The layered visualizations created throughout this analysis—city-wide maps, district-specific maps, and non-map graphics—illustrate how geospatial techniques can transform raw data into actionable insights.</p>
<p>Overall, this mini-project demonstrates how data-driven decision-making can support more equitable distribution of environmental resources. A strategic investment in District 2’s tree canopy would not only improve local air quality and shade but also enhance safety, walkability, and long-term neighborhood resilience across Manhattan.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>